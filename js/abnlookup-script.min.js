function itsg_gf_abnlookup_function(e,o,i){var n=gf_abnlookup_settings.ajax_url,a=gf_abnlookup_settings.validation_message_loading,s=gf_abnlookup_settings.validation_message_not_valid,t=gf_abnlookup_settings.validation_message_error_communicating,l=gf_abnlookup_settings.validation_message_11_char,r=gf_abnlookup_settings.text_checking,_=gf_abnlookup_settings.text_check_abn,d=gf_abnlookup_settings.gst_value_yes,u=gf_abnlookup_settings.gst_value_no,p=gf_abnlookup_settings.lookup_timeout,g=gf_abnlookup_settings.lookup_retries;!function(o){"use strict";var i=!1,f=jQuery(".gform_abnlookup_field_"+e+' input[type="text"]'),y=jQuery(".gform_abnlookup_field_"+e+" .gfield_description.validation_message"),c=jQuery(".itsg_abnlookup_response_"+e),h=jQuery(".itsg_abnlookup_checkabn_"+e),b=jQuery(".gform_abnlookup_entity_gst_field_"+e),v=jQuery(".gform_abnlookup_entity_gst_field_"+e+' input[value="'+d+'"]'),m=jQuery(".gform_abnlookup_entity_gst_field_"+e+' input[value="'+u+'"]'),k=jQuery(".gform_abnlookup_entity_type_field_"+e),j=jQuery(".gform_abnlookup_entity_type_field_"+e+" input"),Q=jQuery(".gform_abnlookup_entity_status_field_"+e),C=jQuery(".gform_abnlookup_entity_status_field_"+e+" input"),x=jQuery(".gform_abnlookup_entity_name_field_"+e),w=jQuery(".gform_abnlookup_entity_name_field_"+e+" input"),N=jQuery(".gform_abnlookup_entity_postcode_field_"+e),E=jQuery(".gform_abnlookup_entity_postcode_field_"+e+" input"),A=jQuery(".gform_abnlookup_entity_state_field_"+e),D=jQuery(".gform_abnlookup_entity_state_field_"+e+" input"),S=jQuery(".gform_abnlookup_entity_effective_from_field_"+e),O=jQuery(".gform_abnlookup_entity_effective_from_field_"+e+" input"),T=jQuery(".gform_abnlookup_gst_effective_from_field_"+e),F=jQuery(".gform_abnlookup_gst_effective_from_field_"+e+" input"),V=jQuery(".gform_abnlookup_business_name_field_"+e),B=jQuery(".gform_abnlookup_business_name_field_"+e+" select");jQuery(".gform_abnlookup_business_name_field_"+e+" option");""!==c.html()?((v.is(":visible")&&1!=v.prop("checked")&&1!=m.prop("checked")||j.is(":visible")&&""==j.val()||C.is(":visible")&&""==C.val()||w.is(":visible")&&""==w.val()||E.is(":visible")&&""==E.val()||D.is(":visible")&&""==D.val()||O.is(":visible")&&""==O.val()||B.is(":visible")&&""==B.val()||F.is(":visible")&&""==F.val())&&f.trigger("change"),v.is(":checked")?m.prop("disabled",!0):m.is(":checked")&&v.prop("disabled",!0),j.prop("readonly",!0),C.prop("readonly",!0),w.prop("readonly",!0),E.prop("readonly",!0),D.prop("readonly",!0),O.prop("readonly",!0),F.prop("readonly",!0)):(b.closest("li.gfield").hide(),k.closest("li.gfield").hide(),Q.closest("li.gfield").hide(),x.closest("li.gfield").hide(),N.closest("li.gfield").hide(),A.closest("li.gfield").hide(),S.closest("li.gfield").hide(),T.closest("li.gfield").hide(),V.closest("li.gfield").hide()),f.unbind("change").change((function(){var d=jQuery(this).val().replace(/\D/g,"");if(11==d.length){gf_abnlookup_settings.debug&&console.log(d);var u={action:"itsg_gf_abnlookup_check_ajax",abn:d};i&&4!==i.readyState&&(gf_abnlookup_settings.debug&&console.log("Abort! -- another request has been submitted."),i.abort()),i=function(i){return o.ajax({type:"POST",url:n,data:i,tryCount:0,retryLimit:g,beforeSend:function(){y.hide(),c.html(a),h.val(r+" ... "),c.addClass("loading"),c.removeClass("error Active Cancelled validation_message")},success:function(o){if(void 0!==o)try{gf_abnlookup_settings.debug&&console.log(o),h.val(_);var i=JSON.parse(o);if(null!=i.exception)y.hide(),"Search text is not a valid ABN or ACN"==i.exception.exceptionDescription?c.html(s):c.text(i.exception.exceptionDescription),c.removeClass("Active Cancelled loading"),c.addClass("error validation_message"),b.hide(),k.hide(),Q.hide(),x.hide(),N.hide(),A.hide(),S.hide(),T.hide(),V.hide(),j.val("").change(),C.val("").change(),w.val("").change(),E.val("").change(),D.val("").change(),O.val("").change(),F.val("").change(),jQuery(".gform_abnlookup_business_name_field_"+e+" option").remove(),v.prop("disabled",!1),m.prop("disabled",!1),v.prop("checked",!1).change().keyup(),m.prop("checked",!1).change().keyup(),j.prop("readonly",!1),C.prop("readonly",!1),w.prop("readonly",!1),E.prop("readonly",!1),D.prop("readonly",!1),O.prop("readonly",!1),F.prop("readonly",!1);else if(null!=i.businessEntity202001){gf_abnlookup_settings.debug&&console.log(i.businessEntity202001);var n=i.businessEntity202001.entityType.entityTypeCode,a=i.businessEntity202001.entityType.entityDescription,t=i.businessEntity202001.entityStatus.entityStatusCode,l=i.businessEntity202001.mainBusinessPhysicalAddress.postcode,r=i.businessEntity202001.mainBusinessPhysicalAddress.stateCode,d=i.businessEntity202001.entityStatus.effectiveFrom,u=i.businessEntity202001.businessName,p=("0"+(G=new Date(d)).getDate()).slice(-2),g=("0"+(G.getMonth()+1)).slice(-2),f=G.getFullYear();if(O.hasClass("dmy"))var P=p+"/"+g+"/"+f;else P=O.hasClass("dmy_dash")?p+"-"+g+"-"+f:O.hasClass("dmy_dot")?p+"."+g+"."+f:O.hasClass("ymd_slash")?f+"/"+g+"/"+G:O.hasClass("ymd_dash")?f+"-"+g+"-"+G:O.hasClass("ymd_dot")?f+"."+g+"."+G:g+"/"+p+"/"+f;if(null!=i.businessEntity202001.goodsAndServicesTax){var G,L=i.businessEntity202001.goodsAndServicesTax.effectiveFrom;if(p=("0"+(G=new Date(L)).getDate()).slice(-2),g=("0"+(G.getMonth()+1)).slice(-2),f=G.getFullYear(),O.hasClass("dmy"))var M=p+"/"+g+"/"+f;else M=F.hasClass("dmy_dash")?p+"-"+g+"-"+f:F.hasClass("dmy_dot")?p+"."+g+"."+f:F.hasClass("ymd_slash")?f+"/"+g+"/"+G:F.hasClass("ymd_dash")?f+"-"+g+"-"+G:F.hasClass("ymd_dot")?f+"."+g+"."+G:g+"/"+p+"/"+f;F.val(M).change(),F.prop("readonly",!0),T.show()}else T.hide(),F.val("").change();if("IND"==n)var Y=("string"==typeof i.businessEntity202001.legalName.familyName?i.businessEntity202001.legalName.familyName:"")+", "+("string"==typeof i.businessEntity202001.legalName.givenName?i.businessEntity202001.legalName.givenName:"")+" "+("string"==typeof i.businessEntity202001.legalName.otherGivenName?i.businessEntity202001.legalName.otherGivenName:"");else Y=i.businessEntity202001.mainName.organisationName;if(void 0!==u){gf_abnlookup_settings.debug&&console.log(u),jQuery(".gform_abnlookup_business_name_field_"+e+" option").remove();var q=new Option(Y,Y,!0,!0);if(B.append(q),u.length)u.forEach((function(e,o,i){var n=new Option(e.organisationName,e.organisationName,!1,!1);B.append(n)}));else{var I=new Option(u.organisationName,u.organisationName,!1,!1);B.append(I)}}else jQuery(".gform_abnlookup_business_name_field_"+e+" option").remove(),q=new Option(Y,Y,!0,!0),B.append(q);y.hide(),c.text(t+" - "+Y),j.val(a).change(),j.prop("readonly",!0),C.val(t).change(),C.prop("readonly",!0),w.val(Y).change(),w.prop("readonly",!0),E.val(l).change(),E.prop("readonly",!0),D.val(r).change(),D.prop("readonly",!0),O.val(P).change(),O.prop("readonly",!0),c.removeClass("error loading validation_message"),c.addClass(t),null!=i.businessEntity202001.goodsAndServicesTax&&"0001-01-01"==i.businessEntity202001.goodsAndServicesTax.effectiveTo?(v.prop("checked",!0).click().change().keyup(),v.prop("disabled",!1),m.prop("disabled",!0)):(m.prop("checked",!0).click().change().keyup(),m.prop("disabled",!1),v.prop("disabled",!0)),b.show(),k.show(),x.show(),Q.show(),N.show(),A.show(),S.show(),V.show()}}catch(e){gf_abnlookup_settings.debug&&console.log(o),c.text(e),c.removeClass("loading Active Cancelled"),c.addClass("error validation_message")}},error:function(e,i,n){if("timeout"==i){if(this.tryCount++,this.tryCount<=this.retryLimit)return void o.ajax(this);c.text(t)}else c.text(e.responseText);h.val(_),c.removeClass("loading Active Cancelled"),c.addClass("error validation_message")},timeout:p})}(u)}else b.hide(),k.hide(),Q.hide(),x.hide(),N.hide(),A.hide(),S.hide(),T.hide(),V.hide(),j.val("").change(),C.val("").change(),w.val("").change(),E.val("").change(),D.val("").change(),O.val("").change(),jQuery(".gform_abnlookup_business_name_field_"+e+" option").remove(),F.val("").change(),v.prop("disabled",!1),m.prop("disabled",!1),v.prop("checked",!1).change().keyup(),m.prop("checked",!1).change().keyup(),y.hide(),c.html(l),c.addClass("error validation_message"),c.removeClass("loading Active Cancelled")}))}(jQuery)}gf_abnlookup_settings.is_ajax?(gform.addAction("gform_input_change",(function(e,o,i){for(var n in abnlookup_fields=gf_abnlookup_settings.abnlookup_fields,abnlookup_fields)if(n==i){var a=abnlookup_fields[n].validate,s=abnlookup_fields[n].dateFormat;void 0!==a&&(gf_abnlookup_settings.debug&&console.log("abn-lookup-for-gravity-forms :: field_id: "+field_id+" field_validate_abnlookup: "+a+" field_dateFormat: "+s),itsg_gf_abnlookup_function(i,a,s))}})),jQuery(document).ready((function(e){var o=gf_abnlookup_settings.abnlookup_fields,i=gf_abnlookup_settings.form_id;for(var n in o){var a=n;jQuery("#input_"+i+"_"+a).unbind("keydown").keydown((function(e){13!=e.which&&13!=e.keyCode||e.preventDefault()})),jQuery("#input_"+i+"_"+a).unbind("keyup").keyup((function(e){13!=e.which&&13!=e.keyCode||e.preventDefault(),numbersOnlyVal=jQuery(this).val().replace(/\D/g,""),11==numbersOnlyVal.length&&jQuery(this).trigger("change")}))}}))):jQuery(document).ready((function(e){var o=gf_abnlookup_settings.abnlookup_fields,i=gf_abnlookup_settings.form_id;for(var n in o){var a=n;jQuery("#input_"+i+"_"+a).unbind("keydown").keydown((function(e){13!=e.which&&13!=e.keyCode||e.preventDefault()})),jQuery("#input_"+i+"_"+a).unbind("keyup").keyup((function(e){13!=e.which&&13!=e.keyCode||e.preventDefault(),numbersOnlyVal=jQuery(this).val().replace(/\D/g,""),11==numbersOnlyVal.length&&jQuery(this).trigger("change")})),jQuery("#input_"+i+"_"+a).on("change keyup",(function(e){var i=o[n].validate,s=o[n].dateFormat;void 0!==i&&(gf_abnlookup_settings.debug&&console.log("abn-lookup-for-gravity-forms :: field_id: "+a+" field_validate_abnlookup: "+i+" field_dateFormat: "+s),itsg_gf_abnlookup_function(a,i,s))}))}}));